

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>coherence.extern.youtubedl.youtubedl &mdash; Cohen3 0.8.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Cohen3
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cli.html">Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../backends.html">Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../write_a_backend.html">Write a backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../events.html">The events system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/coherence.html">Cohen3 source tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributor_code_of_conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cohen3</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>coherence.extern.youtubedl.youtubedl</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for coherence.extern.youtubedl.youtubedl</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Author: Ricardo Garcia Gonzalez</span>
<span class="c1"># Author: Danny Colligan</span>
<span class="c1"># Author: Jean-Michel Sizun (integration within coherence framework)</span>
<span class="c1"># License: Public domain code</span>
<span class="kn">import</span> <span class="nn">html.entities</span>
<span class="kn">import</span> <span class="nn">http.client</span>
<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">netrc</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">urllib.error</span>

<span class="kn">from</span> <span class="nn">coherence.upnp.core.utils</span> <span class="k">import</span> <span class="n">getPage</span>

<span class="n">std_headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.1.2)&#39;</span>
                  <span class="s1">&#39; Gecko/20090729 Firefox/3.5.2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Charset&#39;</span><span class="p">:</span> <span class="s1">&#39;ISO-8859-1,utf-8;q=0.7,*;q=0.7&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/xml,application/xml,application/xhtml+xml,&#39;</span>
              <span class="s1">&#39;text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Accept-Language&#39;</span><span class="p">:</span> <span class="s1">&#39;en-us,en;q=0.5&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">simple_title_chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>


<div class="viewcode-block" id="preferredencoding"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.preferredencoding">[docs]</a><span class="k">def</span> <span class="nf">preferredencoding</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Get preferred encoding.</span>

<span class="sd">    Returns the best encoding scheme for the system, based on</span>
<span class="sd">    locale.getpreferredencoding() and some further tweaks.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pref</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">getpreferredencoding</span><span class="p">()</span>
        <span class="c1"># Mac OSX systems have this problem sometimes</span>
        <span class="k">if</span> <span class="n">pref</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;UTF-8&#39;</span>
        <span class="k">return</span> <span class="n">pref</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;WARNING: problem obtaining preferred encoding. &#39;</span>
            <span class="s1">&#39;Falling back to UTF-8.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;UTF-8&#39;</span></div>


<div class="viewcode-block" id="DownloadError"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.DownloadError">[docs]</a><span class="k">class</span> <span class="nc">DownloadError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Download Error exception.</span>

<span class="sd">    This exception may be thrown by FileDownloader objects if they are not</span>
<span class="sd">    configured to continue on errors. They will contain the appropriate</span>
<span class="sd">    error message.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="SameFileError"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.SameFileError">[docs]</a><span class="k">class</span> <span class="nc">SameFileError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Same File exception.</span>

<span class="sd">    This exception will be thrown by FileDownloader objects if they detect</span>
<span class="sd">    multiple files would have to be downloaded to the same file on disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PostProcessingError"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessingError">[docs]</a><span class="k">class</span> <span class="nc">PostProcessingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Post Processing exception.</span>

<span class="sd">    This exception may be raised by PostProcessor&#39;s .run() method to</span>
<span class="sd">    indicate an error in the postprocessing task.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="UnavailableFormatError"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.UnavailableFormatError">[docs]</a><span class="k">class</span> <span class="nc">UnavailableFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Unavailable Format exception.</span>

<span class="sd">    This exception will be thrown when a video is requested</span>
<span class="sd">    in a format that is not available for that video.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ContentTooShortError"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.ContentTooShortError">[docs]</a><span class="k">class</span> <span class="nc">ContentTooShortError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Content Too Short exception.</span>

<span class="sd">    This exception may be raised by FileDownloader objects when a file they</span>
<span class="sd">    download is too small for what the server announced first, indicating</span>
<span class="sd">    the connection was probably interrupted.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Both in bytes</span>
    <span class="n">downloaded</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloaded</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloaded</span> <span class="o">=</span> <span class="n">downloaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">expected</span></div>


<div class="viewcode-block" id="FileDownloader"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader">[docs]</a><span class="k">class</span> <span class="nc">FileDownloader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;File Downloader class.</span>

<span class="sd">    File downloader objects are the ones responsible of downloading the</span>
<span class="sd">    actual video file and writing it to disk if the user has requested</span>
<span class="sd">    it, among some other tasks. In most cases there should be one per</span>
<span class="sd">    program. As, given a video URL, the downloader doesn&#39;t know how to</span>
<span class="sd">    extract all the needed information, task that InfoExtractors do, it</span>
<span class="sd">    has to pass the URL to one of them.</span>

<span class="sd">    For this, file downloader objects have a method that allows</span>
<span class="sd">    InfoExtractors to be registered in a given order. When it is passed</span>
<span class="sd">    a URL, the file downloader handles it to the first InfoExtractor it</span>
<span class="sd">    finds that reports being able to handle it. The InfoExtractor extracts</span>
<span class="sd">    all the information about the video or videos the URL refers to, and</span>
<span class="sd">    asks the FileDownloader to process the video information, possibly</span>
<span class="sd">    downloading the video.</span>

<span class="sd">    File downloaders accept a lot of parameters. In order not to saturate</span>
<span class="sd">    the object constructor with arguments, it receives a dictionary of</span>
<span class="sd">    options instead. These options are available through the params</span>
<span class="sd">    attribute for the InfoExtractors to use. The FileDownloader also</span>
<span class="sd">    registers itself as the downloader in charge for the InfoExtractors</span>
<span class="sd">    that are added to it, so this is a &quot;mutual registration&quot;.</span>

<span class="sd">    Available options:</span>

<span class="sd">    username:	Username for authentication purposes.</span>
<span class="sd">    password:	Password for authentication purposes.</span>
<span class="sd">    usenetrc:	Use netrc for authentication instead.</span>
<span class="sd">    quiet:		Do not print messages to stdout.</span>
<span class="sd">    forceurl:	Force printing final URL.</span>
<span class="sd">    forcetitle:	Force printing title.</span>
<span class="sd">    simulate:	Do not download the video files.</span>
<span class="sd">    format:		Video format code.</span>
<span class="sd">    outtmpl:	Template for output names.</span>
<span class="sd">    ignoreerrors:	Do not stop on download errors.</span>
<span class="sd">    ratelimit:	Download speed limit, in bytes/sec.</span>
<span class="sd">    nooverwrites:    Prevent overwriting files.</span>
<span class="sd">    continuedl:    Try to continue downloads if possible.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_ies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_pps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_download_retcode</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FileDownloader.__init__"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a FileDownloader object with the given options.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_retcode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span></div>

<div class="viewcode-block" id="FileDownloader.pmkdir"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.pmkdir">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pmkdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create directory components in filename. Similar to Unix &quot;mkdir -p&quot;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>
        <span class="n">aggregate</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">))]</span>
        <span class="n">aggregate</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{x}{os.sep}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="n">aggregate</span><span class="p">]</span>  <span class="c1"># Finish names with separator</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.format_bytes"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.format_bytes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">format_bytes</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">bytes</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">exponent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exponent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="mf">1024.0</span><span class="p">))</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;bkMGTPEZY&#39;</span><span class="p">[</span><span class="n">exponent</span><span class="p">]</span>
        <span class="n">converted</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1024</span> <span class="o">**</span> <span class="n">exponent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{converted:.2f}{suffix}</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="FileDownloader.calc_percent"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.calc_percent">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calc_percent</span><span class="p">(</span><span class="n">byte_counter</span><span class="p">,</span> <span class="n">data_len</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data_len</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;---.-%&#39;</span>
        <span class="k">return</span> \
            <span class="s1">&#39;</span><span class="si">%6s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%3.1f%%</span><span class="s1">&#39;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">byte_counter</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">data_len</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="FileDownloader.calc_eta"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.calc_eta">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calc_eta</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;--:--&#39;</span>
        <span class="n">dif</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dif</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>  <span class="c1"># One millisecond</span>
            <span class="k">return</span> <span class="s1">&#39;--:--&#39;</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">/</span> <span class="n">dif</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">))</span> <span class="o">/</span> <span class="n">rate</span><span class="p">)</span>
        <span class="p">(</span><span class="n">eta_mins</span><span class="p">,</span> <span class="n">eta_secs</span><span class="p">)</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eta_mins</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;--:--&#39;</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{eta_mins:02d}</span><span class="s1">:</span><span class="si">{eta_secs:02d}</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="FileDownloader.calc_speed"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.calc_speed">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calc_speed</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">dif</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">if</span> <span class="nb">bytes</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">dif</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>  <span class="c1"># One millisecond</span>
            <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;{&quot;---b/s&quot;:&gt;10}&#39;</span>
        <span class="k">return</span> \
            <span class="s1">&#39;</span><span class="si">%10s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/s&#39;</span> <span class="o">%</span> <span class="n">FileDownloader</span><span class="o">.</span><span class="n">format_bytes</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">/</span> <span class="n">dif</span><span class="p">))</span></div>

<div class="viewcode-block" id="FileDownloader.best_block_size"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.best_block_size">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">best_block_size</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">new_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">bytes</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">new_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">bytes</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mi">4194304</span><span class="p">)</span>  <span class="c1"># Do not surpass 4 MB</span>
        <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_max</span><span class="p">)</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="nb">bytes</span> <span class="o">/</span> <span class="n">elapsed_time</span>
        <span class="k">if</span> <span class="n">rate</span> <span class="o">&gt;</span> <span class="n">new_max</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rate</span> <span class="o">&lt;</span> <span class="n">new_min</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_min</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.parse_bytes"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.parse_bytes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse_bytes</span><span class="p">(</span><span class="n">bytestr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parse a string indicating a byte quantity into a long integer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">matchobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)^(\d+(?:\.\d+)?)([kMGTPEZY]?)$&#39;</span><span class="p">,</span> <span class="n">bytestr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matchobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">number</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="mf">1024.0</span> <span class="o">**</span> <span class="s1">&#39;bkmgtpezy&#39;</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">))</span></div>

<div class="viewcode-block" id="FileDownloader.verify_url"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.verify_url">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">verify_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Verify a URL is valid and data could be downloaded.</span>
<span class="sd">        Return real data URL.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_headers</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">url</span></div>

<div class="viewcode-block" id="FileDownloader.add_info_extractor"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.add_info_extractor">[docs]</a>    <span class="k">def</span> <span class="nf">add_info_extractor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ie</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add an InfoExtractor object to the end of the list.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ie</span><span class="p">)</span>
        <span class="n">ie</span><span class="o">.</span><span class="n">set_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.add_post_processor"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.add_post_processor">[docs]</a>    <span class="k">def</span> <span class="nf">add_post_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pp</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add a PostProcessor object to the end of the chain.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">set_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.to_stdout"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.to_stdout">[docs]</a>    <span class="k">def</span> <span class="nf">to_stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">skip_eol</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stdout if not in quiet mode.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">][</span><span class="n">skip_eol</span><span class="p">]))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
                <span class="n">preferredencoding</span><span class="p">()),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>

<div class="viewcode-block" id="FileDownloader.to_stderr"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.to_stderr">[docs]</a>    <span class="k">def</span> <span class="nf">to_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stderr.&#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">preferredencoding</span><span class="p">()),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.fixed_template"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.fixed_template">[docs]</a>    <span class="k">def</span> <span class="nf">fixed_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Checks if the output template is fixed.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?u)%\(.+?\)s&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FileDownloader.trouble"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.trouble">[docs]</a>    <span class="k">def</span> <span class="nf">trouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Determine action to take when a download problem appears.</span>

<span class="sd">        Depending on if the downloader has been configured to ignore</span>
<span class="sd">        download errors or not, this method may throw an exception or</span>
<span class="sd">        not when errors are found, after printing the message.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignoreerrors&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DownloadError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_download_retcode</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_retcode</span></div>

<div class="viewcode-block" id="FileDownloader.slow_down"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.slow_down">[docs]</a>    <span class="k">def</span> <span class="nf">slow_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">byte_counter</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sleep if the download speed is over the rate limit.&#39;&#39;&#39;</span>
        <span class="n">rate_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ratelimit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rate_limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">byte_counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">byte_counter</span><span class="p">)</span> <span class="o">/</span> <span class="n">elapsed</span>
        <span class="k">if</span> <span class="n">speed</span> <span class="o">&gt;</span> <span class="n">rate_limit</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span>
                <span class="p">(</span><span class="n">byte_counter</span> <span class="o">-</span> <span class="n">rate_limit</span> <span class="o">*</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span> <span class="o">/</span> <span class="n">rate_limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_destination"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_destination">[docs]</a>    <span class="k">def</span> <span class="nf">report_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report destination filename.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[download] Destination: </span><span class="si">{filename}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_progress"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_progress">[docs]</a>    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent_str</span><span class="p">,</span> <span class="n">data_len_str</span><span class="p">,</span> <span class="n">speed_str</span><span class="p">,</span> <span class="n">eta_str</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report download progress.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">[download] </span><span class="si">{percent_str}</span><span class="s1"> of </span><span class="si">{data_len_str}</span><span class="s1"> at &#39;</span>
            <span class="n">f</span><span class="s1">&#39;</span><span class="si">{speed_str}</span><span class="s1"> ETA </span><span class="si">{eta_str}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">skip_eol</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_resuming_byte"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_resuming_byte">[docs]</a>    <span class="k">def</span> <span class="nf">report_resuming_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resume_len</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attemtp to resume at given byte.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[download] Resuming download at byte </span><span class="si">{resume_len}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_file_already_downloaded"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_file_already_downloaded">[docs]</a>    <span class="k">def</span> <span class="nf">report_file_already_downloaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report file has already been fully downloaded.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[download] </span><span class="si">{file_name}</span><span class="s1"> has already been downloaded&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_unable_to_resume"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_unable_to_resume">[docs]</a>    <span class="k">def</span> <span class="nf">report_unable_to_resume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report it was impossible to resume download.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[download] Unable to resume&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.report_finish"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.report_finish">[docs]</a>    <span class="k">def</span> <span class="nf">report_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report download finished.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader._do_download"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader._do_download">[docs]</a>    <span class="k">def</span> <span class="nf">_do_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Error: the _do_download method was removed&#39;</span>
                                  <span class="s1">&#39;at some point of the project, operation&#39;</span>
                                  <span class="s1">&#39;cancelled&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileDownloader.process_info"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.process_info">[docs]</a>    <span class="k">def</span> <span class="nf">process_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Process a single dictionary returned by an InfoExtractor.&#39;&#39;&#39;</span>
        <span class="c1"># Do nothing else if in simulate mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;simulate&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_url</span><span class="p">(</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                    <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnavailableFormatError</span>

            <span class="c1"># Forced printings</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forcetitle&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">preferredencoding</span><span class="p">()))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forceurl&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">preferredencoding</span><span class="p">()))</span>

            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">template_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info_dict</span><span class="p">)</span>
            <span class="n">template_dict</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">template_dict</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: invalid output template or system charset: {str(err)}&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;nooverwrites&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;WARNING: file exists: </span><span class="si">{filename}</span><span class="s1">; skipping&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pmkdir</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: unable to create directories: {str(err)}&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fixme: This should be reimplemented, probably that the best shoot</span>
            <span class="c1">#  will be to use an external python package to deal with that</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_download</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: unable to download video data: {str(err)}&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">ContentTooShortError</span><span class="p">,)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: content too short &#39;</span>
                <span class="n">f</span><span class="s1">&#39;(expected </span><span class="si">{err.expected}</span><span class="s1"> bytes and served </span><span class="si">{err.downloaded}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnavailableFormatError</span>

        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">post_process</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">info_dict</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PostProcessingError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: postprocessing: {str(err)}&#39;</span><span class="p">)</span>
                <span class="k">return</span></div>

<div class="viewcode-block" id="FileDownloader.download"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.download">[docs]</a>    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download a given list of URLs.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_template</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SameFileError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
            <span class="n">suitable_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ies</span><span class="p">:</span>
                <span class="c1"># Go to next InfoExtractor if not suitable</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ie</span><span class="o">.</span><span class="n">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># Suitable InfoExtractor found</span>
                <span class="n">suitable_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Extract information from URL and process it</span>
                <span class="n">ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

                <span class="c1"># Suitable InfoExtractor had been found; go to next URL</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">suitable_found</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: no suitable InfoExtractor: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_retcode</span></div>

<div class="viewcode-block" id="FileDownloader.get_real_urls"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.get_real_urls">[docs]</a>    <span class="k">def</span> <span class="nf">get_real_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Download a given list of URLs.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">url_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_template</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SameFileError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
            <span class="n">suitable_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ies</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ie</span><span class="o">.</span><span class="n">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="c1"># Suitable InfoExtractor found</span>
                <span class="n">suitable_found</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">def</span> <span class="nf">got_all_results</span><span class="p">(</span><span class="n">all_results</span><span class="p">):</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">all_results</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">):</span>
                        <span class="n">ret_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trouble</span><span class="p">()</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_template</span><span class="p">():</span>
                        <span class="k">raise</span> <span class="n">SameFileError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">])</span>

                    <span class="n">real_urls</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                        <span class="n">real_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">real_urls</span>

                <span class="n">d</span> <span class="o">=</span> <span class="n">ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">got_all_results</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">d</span>

        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="FileDownloader.post_process"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.FileDownloader.post_process">[docs]</a>    <span class="k">def</span> <span class="nf">post_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">ie_info</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Run the postprocessing chain on the given file.&#39;&#39;&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ie_info</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;filepath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pps</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span></div></div>


<span class="c1"># _do_download REMOVED</span>

<div class="viewcode-block" id="InfoExtractor"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor">[docs]</a><span class="k">class</span> <span class="nc">InfoExtractor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Information Extractor class.</span>

<span class="sd">    Information extractors are the classes that, given a URL, extract</span>
<span class="sd">    information from the video (or videos) the URL refers to. This</span>
<span class="sd">    information includes the real video URL, the video title and simplified</span>
<span class="sd">    title, author and others. The information is stored in a dictionary</span>
<span class="sd">    which is then passed to the FileDownloader. The FileDownloader</span>
<span class="sd">    processes this information possibly downloading the video to the file</span>
<span class="sd">    system, among other possible outcomes. The dictionaries must include</span>
<span class="sd">    the following fields:</span>

<span class="sd">    id:		Video identifier.</span>
<span class="sd">    url:		Final video URL.</span>
<span class="sd">    uploader:	Nickname of the video uploader.</span>
<span class="sd">    title:		Literal title.</span>
<span class="sd">    stitle:		Simplified title.</span>
<span class="sd">    ext:		Video filename extension.</span>

<span class="sd">    Subclasses of this one should re-define the _real_initialize() and</span>
<span class="sd">    _real_extract() methods, as well as the suitable() static method.</span>
<span class="sd">    Probably, they should also be instantiated and added to the main</span>
<span class="sd">    downloader.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">_ready</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_downloader</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="InfoExtractor.__init__"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Constructor. Receives an optional downloader.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_downloader</span><span class="p">(</span><span class="n">downloader</span><span class="p">)</span></div>

<div class="viewcode-block" id="InfoExtractor.suitable"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.suitable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Receives a URL and returns True if suitable for this IE.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="InfoExtractor.initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initializes an instance (authentication, etc).&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_real_initialize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="InfoExtractor.extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extracts URL information and returns it in list of dicts.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_real_extract</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>

<div class="viewcode-block" id="InfoExtractor.set_downloader"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.set_downloader">[docs]</a>    <span class="k">def</span> <span class="nf">set_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the downloader for this IE.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="o">=</span> <span class="n">downloader</span></div>

<div class="viewcode-block" id="InfoExtractor.to_stdout"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.to_stdout">[docs]</a>    <span class="k">def</span> <span class="nf">to_stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stdout if downloader is not in quiet mode.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="InfoExtractor.to_stderr"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor.to_stderr">[docs]</a>    <span class="k">def</span> <span class="nf">to_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stderr.&#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="InfoExtractor._real_initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor._real_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">_real_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Real initialization process. Redefine in subclasses.&#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="InfoExtractor._real_extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.InfoExtractor._real_extract">[docs]</a>    <span class="k">def</span> <span class="nf">_real_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Real extraction process. Redefine in subclasses.&#39;&#39;&#39;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="YoutubeIE"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE">[docs]</a><span class="k">class</span> <span class="nc">YoutubeIE</span><span class="p">(</span><span class="n">InfoExtractor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Information extractor for youtube.com.&#39;&#39;&#39;</span>

    <span class="n">_VALID_URL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^((?:https://)?(?:\w+\.)?youtube\.com/(?:(?:v/)|&#39;</span> \
                 <span class="sa">r</span><span class="s1">&#39;(?:(?:watch(?:\.php)?)?\?(?:.+&amp;)?v=)))?([0-9A-Za-z_-]+)&#39;</span> \
                 <span class="sa">r</span><span class="s1">&#39;(?(1).+)?$&#39;</span>
    <span class="n">_LANG_URL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https://uk.youtube.com/?hl=en&amp;persist_hl=1&#39;</span> \
                <span class="sa">r</span><span class="s1">&#39;&amp;gl=US&amp;persist_gl=1&amp;opt_out_ackd=1&#39;</span>
    <span class="n">_LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.youtube.com/signup?next=/&amp;gl=US&amp;hl=en&#39;</span>
    <span class="n">_AGE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.youtube.com/verify_age?next_url=/&amp;gl=US&amp;hl=en&#39;</span>
    <span class="n">_NETRC_MACHINE</span> <span class="o">=</span> <span class="s1">&#39;youtube&#39;</span>
    <span class="c1"># _available_formats listed in order of priority for -b flag</span>
    <span class="n">_available_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;22&#39;</span><span class="p">,</span> <span class="s1">&#39;35&#39;</span><span class="p">,</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;17&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">_video_extensions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;13&#39;</span><span class="p">:</span> <span class="s1">&#39;3gp&#39;</span><span class="p">,</span>
        <span class="s1">&#39;17&#39;</span><span class="p">:</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;18&#39;</span><span class="p">:</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;22&#39;</span><span class="p">:</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="YoutubeIE.suitable"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.suitable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">YoutubeIE</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="YoutubeIE.htmlentity_transform"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.htmlentity_transform">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">htmlentity_transform</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Transforms an HTML entity to a Unicode character.&#39;&#39;&#39;</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Known non-numeric HTML entity</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">html</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">name2codepoint</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">name2codepoint</span><span class="p">[</span><span class="n">entity</span><span class="p">])</span>

        <span class="c1"># Unicode character</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?u)#(x?\d+)&#39;</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">numstr</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numstr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="n">numstr</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;0</span><span class="si">{numstr}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">base</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">numstr</span><span class="p">,</span> <span class="n">base</span><span class="p">))</span>

        <span class="c1"># Unknown entity in name, return its literal representation</span>
        <span class="k">return</span> <span class="n">f</span><span class="s1">&#39;&amp;</span><span class="si">{entity}</span><span class="s1">;&#39;</span></div>

<div class="viewcode-block" id="YoutubeIE.report_lang"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_lang">[docs]</a>    <span class="k">def</span> <span class="nf">report_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to set language.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[youtube] Setting language&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_login"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_login">[docs]</a>    <span class="k">def</span> <span class="nf">report_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to log in.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[youtube] Logging in&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_age_confirmation"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_age_confirmation">[docs]</a>    <span class="k">def</span> <span class="nf">report_age_confirmation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to confirm age.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[youtube] Confirming age&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_video_info_webpage_download"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_video_info_webpage_download">[docs]</a>    <span class="k">def</span> <span class="nf">report_video_info_webpage_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to download video info webpage.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] </span><span class="si">{video_id}</span><span class="s1">: Downloading video info webpage&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_information_extraction"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_information_extraction">[docs]</a>    <span class="k">def</span> <span class="nf">report_information_extraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to extract video information.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] </span><span class="si">{video_id}</span><span class="s1">: Extracting video information&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_unavailable_format"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_unavailable_format">[docs]</a>    <span class="k">def</span> <span class="nf">report_unavailable_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">,</span> <span class="nb">format</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report extracted video URL.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] </span><span class="si">{video_id}</span><span class="s1">: Format </span><span class="si">{format}</span><span class="s1"> not available&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE.report_video_url"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE.report_video_url">[docs]</a>    <span class="k">def</span> <span class="nf">report_video_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_real_url</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report extracted video URL.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] </span><span class="si">{video_id}</span><span class="s1">: URL: </span><span class="si">{video_real_url}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE._real_initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE._real_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">_real_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">username</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">downloader_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">params</span>

        <span class="c1"># Attempt to use provided username and password or .netrc data</span>
        <span class="k">if</span> <span class="n">downloader_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">downloader_params</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">downloader_params</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">downloader_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usenetrc&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NETRC_MACHINE</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">username</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">password</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">netrc</span><span class="o">.</span><span class="n">NetrcParseError</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;No authenticators for </span><span class="si">{self._NETRC_MACHINE}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="n">netrc</span><span class="o">.</span><span class="n">NetrcParseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;WARNING: parsing .netrc: {str(err)}&#39;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">def</span> <span class="nf">gotAgeConfirmedPage</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Age confirmed in Youtube&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">gotLoggedInPage</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)&lt;form[^&gt;]* name=&quot;loginForm&quot;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: unable to log in: bad username or password&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logged in in Youtube&#39;</span><span class="p">)</span>

            <span class="c1"># Confirm age</span>
            <span class="n">age_form</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;next_url&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action_confirm&#39;</span><span class="p">:</span> <span class="s1">&#39;Confirm&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">age_form</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">getPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AGE_URL</span><span class="p">,</span> <span class="n">postdata</span><span class="o">=</span><span class="n">postdata</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">std_headers</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">gotAgeConfirmedPage</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">gotLoginError</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Unable to login to Youtube: &#39;</span>
                  <span class="n">f</span><span class="s1">&#39;</span><span class="si">{username}</span><span class="s1">:</span><span class="si">{password}</span><span class="s1"> @ </span><span class="si">{self._LOGIN_URL}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Error: </span><span class="si">{error}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">def</span> <span class="nf">gotLanguageSet</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">result</span>
            <span class="c1"># No authentication to be performed</span>
            <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># Log in</span>
            <span class="n">login_form</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;current_form&#39;</span><span class="p">:</span> <span class="s1">&#39;loginForm&#39;</span><span class="p">,</span>
                <span class="s1">&#39;next&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action_login&#39;</span><span class="p">:</span> <span class="s1">&#39;Log In&#39;</span><span class="p">,</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">postdata</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">login_form</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">getPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_LOGIN_URL</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">postdata</span><span class="o">=</span><span class="n">postdata</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">std_headers</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">addCallbacks</span><span class="p">(</span><span class="n">gotLoggedInPage</span><span class="p">,</span> <span class="n">gotLoginError</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">gotLanguageSetError</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Unable to process Youtube request: </span><span class="si">{self._LANG_URL}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Error: </span><span class="si">{error}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Set language (will lead to log in, and then age confirmation)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">getPage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_LANG_URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">std_headers</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallbacks</span><span class="p">(</span><span class="n">gotLanguageSet</span><span class="p">,</span> <span class="n">gotLanguageSetError</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeIE._real_extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeIE._real_extract">[docs]</a>    <span class="k">def</span> <span class="nf">_real_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="c1"># Extract video id from URL</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: invalid URL: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">video_id</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Downloader parameters</span>
        <span class="n">best_quality</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">format_param</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">video_extension</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">quality_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">params</span>
            <span class="n">format_param</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">format_param</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                <span class="n">format_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_available_formats</span><span class="p">[</span><span class="n">quality_index</span><span class="p">]</span>
                <span class="n">best_quality</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">video_extension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_video_extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">format_param</span><span class="p">,</span> <span class="s1">&#39;flv&#39;</span><span class="p">)</span>

        <span class="c1"># video info</span>
        <span class="n">video_info_url</span> <span class="o">=</span> \
            <span class="n">f</span><span class="s1">&#39;https://www.youtube.com/get_video_info?&amp;video_id=</span><span class="si">{video_id}</span><span class="s1">&amp;&#39;</span> \
            <span class="n">f</span><span class="s1">&#39;el=detailpage&amp;ps=default&amp;eurl=&amp;gl=US&amp;hl=en&#39;</span>
        <span class="k">if</span> <span class="n">format_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">video_info_url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{video_info_url}</span><span class="s1">&amp;fmt=</span><span class="si">{format_param}</span><span class="s1">&#39;</span>

        <span class="k">def</span> <span class="nf">gotPage</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">format_param</span><span class="p">,</span> <span class="n">video_extension</span><span class="p">):</span>
            <span class="n">video_info_webpage</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">result</span>

            <span class="c1"># check format</span>
            <span class="k">if</span> <span class="n">format_param</span> <span class="o">==</span> <span class="s1">&#39;22&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Check if HD video exists...&#39;</span><span class="p">)</span>
                <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;var isHDAvailable = true;&#39;</span><span class="p">,</span>
                                 <span class="n">video_info_webpage</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No HD video -&gt; switch back to SD&#39;</span><span class="p">)</span>
                    <span class="n">format_param</span> <span class="o">=</span> <span class="s1">&#39;18&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;...HD video OK!&#39;</span><span class="p">)</span>

            <span class="c1"># &quot;t&quot; param</span>
            <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)&amp;token=([^&amp;]+)(?:&amp;|$)&#39;</span><span class="p">,</span> <span class="n">video_info_webpage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Attempt to see if YouTube has issued an error message</span>
                <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)&amp;reason=([^&amp;]+)(?:&amp;|$)&#39;</span><span class="p">,</span>
                                 <span class="n">video_info_webpage</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span><span class="s1">&#39;ERROR: unable to extract &quot;t&quot; parameter&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">video_info_webpage</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reason</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote_plus</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;ERROR: YouTube said: {reason.decode(&quot;utf-8&quot;)}&#39;</span><span class="p">)</span>

            <span class="n">token</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">video_real_url</span> <span class="o">=</span> \
                <span class="n">f</span><span class="s1">&#39;https://www.youtube.com/get_video?video_id=</span><span class="si">{video_id}</span><span class="s1">&amp;&#39;</span> \
                <span class="n">f</span><span class="s1">&#39;t=</span><span class="si">{token}</span><span class="s1">&amp;eurl=&amp;el=detailpage&amp;ps=default&amp;gl=US&amp;hl=en&#39;</span>
            <span class="k">if</span> <span class="n">format_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">video_real_url</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{video_real_url}</span><span class="s1">&amp;fmt=</span><span class="si">{format_param}</span><span class="s1">&#39;</span>

            <span class="c1"># uploader</span>
            <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)&amp;author=([^&amp;]+)(?:&amp;|$)&#39;</span><span class="p">,</span> <span class="n">video_info_webpage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                    <span class="s1">&#39;ERROR: unable to extract uploader nickname&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">video_uploader</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

            <span class="c1"># title</span>
            <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)&amp;title=([^&amp;]+)(?:&amp;|$)&#39;</span><span class="p">,</span> <span class="n">video_info_webpage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                    <span class="s1">&#39;ERROR: unable to extract video title&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">video_title</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">video_title</span> <span class="o">=</span> <span class="n">video_title</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">video_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?u)&amp;(.+?);&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">htmlentity_transform</span><span class="p">,</span>
                                 <span class="n">video_title</span><span class="p">)</span>
            <span class="n">video_title</span> <span class="o">=</span> <span class="n">video_title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>

            <span class="c1"># simplified title</span>
            <span class="n">simple_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">fr</span><span class="s1">&#39;(?u)([^</span><span class="si">{simple_title_chars}</span><span class="s1">]+)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                                  <span class="n">video_title</span><span class="p">)</span>
            <span class="n">simple_title</span> <span class="o">=</span> <span class="n">simple_title</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>

            <span class="c1"># Return information</span>
            <span class="k">return</span> <span class="p">[{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">video_id</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">video_real_url</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;uploader&#39;</span><span class="p">:</span> <span class="n">video_uploader</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">video_title</span><span class="p">,</span>
                <span class="s1">&#39;stitle&#39;</span><span class="p">:</span> <span class="n">simple_title</span><span class="p">,</span>
                <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="n">video_extension</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
            <span class="p">}]</span>

        <span class="k">def</span> <span class="nf">gotError</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Unable to process Youtube request: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;Error: </span><span class="si">{error}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">getPage</span><span class="p">(</span><span class="n">video_info_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">std_headers</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">gotPage</span><span class="p">,</span> <span class="n">format_param</span><span class="p">,</span> <span class="n">video_extension</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="n">gotError</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>


<div class="viewcode-block" id="MetacafeIE"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE">[docs]</a><span class="k">class</span> <span class="nc">MetacafeIE</span><span class="p">(</span><span class="n">InfoExtractor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Information Extractor for metacafe.com.&#39;&#39;&#39;</span>

    <span class="n">_VALID_URL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:https://)?(?:www\.)?metacafe\.com/&#39;</span> \
                 <span class="sa">r</span><span class="s1">&#39;watch/([^/]+)/([^/]+)/.*&#39;</span>
    <span class="n">_DISCLAIMER</span> <span class="o">=</span> <span class="s1">&#39;https://www.metacafe.com/family_filter/&#39;</span>
    <span class="n">_FILTER_POST</span> <span class="o">=</span> <span class="s1">&#39;https://www.metacafe.com/f/index.php?&#39;</span> \
                   <span class="s1">&#39;inputType=filter&amp;controllerGroup=user&#39;</span>
    <span class="n">_youtube_ie</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">youtube_ie</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">InfoExtractor</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span> <span class="o">=</span> <span class="n">youtube_ie</span>

<div class="viewcode-block" id="MetacafeIE.suitable"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE.suitable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">MetacafeIE</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetacafeIE.report_disclaimer"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE.report_disclaimer">[docs]</a>    <span class="k">def</span> <span class="nf">report_disclaimer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report disclaimer retrieval.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[metacafe] Retrieving disclaimer&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetacafeIE.report_age_confirmation"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE.report_age_confirmation">[docs]</a>    <span class="k">def</span> <span class="nf">report_age_confirmation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to confirm age.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span><span class="s1">&#39;[metacafe] Confirming age&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetacafeIE.report_download_webpage"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE.report_download_webpage">[docs]</a>    <span class="k">def</span> <span class="nf">report_download_webpage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report webpage download.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[metacafe] </span><span class="si">{video_id}</span><span class="s1">: Downloading webpage&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetacafeIE.report_extraction"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE.report_extraction">[docs]</a>    <span class="k">def</span> <span class="nf">report_extraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report information extraction.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[metacafe] </span><span class="si">{video_id}</span><span class="s1">: Extracting information&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetacafeIE._real_initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE._real_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">_real_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Retrieve disclaimer</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DISCLAIMER</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_headers</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_disclaimer</span><span class="p">()</span>
            <span class="n">disclaimer</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: unable to retrieve disclaimer: {str(err)}&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Confirm age</span>
        <span class="n">disclaimer_form</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;submit&#39;</span><span class="p">:</span> <span class="s1">&#39;Continue - I</span><span class="se">\&#39;</span><span class="s1">m over 18&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_FILTER_POST</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span>
                <span class="n">disclaimer_form</span><span class="p">),</span> <span class="n">std_headers</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_age_confirmation</span><span class="p">()</span>
            <span class="n">disclaimer</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: unable to confirm age: {str(err)}&#39;</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="MetacafeIE._real_extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.MetacafeIE._real_extract">[docs]</a>    <span class="k">def</span> <span class="nf">_real_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="c1"># Extract id and simplified title from URL</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: invalid URL: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">video_id</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Check if video comes from YouTube</span>
        <span class="n">mobj2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^yt-(.*)$&#39;</span><span class="p">,</span> <span class="n">video_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;https://www.youtube.com/watch?v={mobj2.group(1)}&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">simple_title</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">video_extension</span> <span class="o">=</span> <span class="s1">&#39;flv&#39;</span>

        <span class="c1"># Retrieve video webpage to extract further information</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;https://www.metacafe.com/watch/</span><span class="si">{video_id}</span><span class="s1">/&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_download_webpage</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
            <span class="n">webpage</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span>
                <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: unable retrieve video webpage: {str(err)}&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Extract URL, uploader and title from webpage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report_extraction</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?m)&amp;mediaURL=([^&amp;]+)&#39;</span><span class="p">,</span> <span class="n">webpage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="s1">&#39;ERROR: unable to extract media URL&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mediaURL</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># mobj = re.search(r&#39;(?m)&amp;gdaKey=(.*?)&amp;&#39;, webpage)</span>
        <span class="c1"># if mobj is None:</span>
        <span class="c1">#    self._downloader.trouble(u&#39;ERROR: unable to extract gdaKey&#39;)</span>
        <span class="c1">#    return</span>
        <span class="c1"># gdaKey = mobj.group(1)</span>
        <span class="c1">#</span>
        <span class="c1"># video_url = f&#39;{mediaURL}?__gda__={gdaKey}&#39;</span>

        <span class="n">video_url</span> <span class="o">=</span> <span class="n">mediaURL</span>

        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?im)&lt;title&gt;(.*) - Video&lt;/title&gt;&#39;</span><span class="p">,</span> <span class="n">webpage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="s1">&#39;ERROR: unable to extract title&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">video_title</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="sa">r</span><span class="s1">&#39;(?ms)&lt;li id=&quot;ChnlUsr&quot;&gt;.*?Submitter:.*?&lt;a .*?&gt;(.*?)&lt;&#39;</span><span class="p">,</span> <span class="n">webpage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="s1">&#39;ERROR: unable to extract uploader nickname&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">video_uploader</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Process video information</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">process_info</span><span class="p">({</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">video_id</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">video_url</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;uploader&#39;</span><span class="p">:</span> <span class="n">video_uploader</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">video_title</span><span class="p">,</span>
                <span class="s1">&#39;stitle&#39;</span><span class="p">:</span> <span class="n">simple_title</span><span class="p">,</span>
                <span class="s1">&#39;ext&#39;</span><span class="p">:</span> <span class="n">video_extension</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
            <span class="p">})</span>
        <span class="k">except</span> <span class="n">UnavailableFormatError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="s1">&#39;ERROR: format not available for video&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="YoutubeSearchIE"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE">[docs]</a><span class="k">class</span> <span class="nc">YoutubeSearchIE</span><span class="p">(</span><span class="n">InfoExtractor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Information Extractor for YouTube search queries.&#39;&#39;&#39;</span>
    <span class="n">_VALID_QUERY</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;ytsearch(\d+|all)?:[\s\S]+&#39;</span>
    <span class="n">_TEMPLATE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.youtube.com/results?&#39;</span> \
                    <span class="s1">&#39;search_query=</span><span class="si">%s</span><span class="s1">&amp;page=</span><span class="si">%s</span><span class="s1">&amp;gl=US&amp;hl=en&#39;</span>
    <span class="n">_VIDEO_INDICATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;href=&quot;/watch\?v=.+?&quot;&#39;</span>
    <span class="n">_MORE_PAGES_INDICATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?m)&gt;\s*Next\s*&lt;/a&gt;&#39;</span>
    <span class="n">_youtube_ie</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_max_youtube_results</span> <span class="o">=</span> <span class="mi">1000</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">youtube_ie</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">InfoExtractor</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span> <span class="o">=</span> <span class="n">youtube_ie</span>

<div class="viewcode-block" id="YoutubeSearchIE.suitable"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE.suitable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">YoutubeSearchIE</span><span class="o">.</span><span class="n">_VALID_QUERY</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="YoutubeSearchIE.report_download_page"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE.report_download_page">[docs]</a>    <span class="k">def</span> <span class="nf">report_download_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">pagenum</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to download playlist page with given number.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] query &quot;</span><span class="si">{query}</span><span class="s1">&quot;: Downloading page </span><span class="si">{pagenum}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubeSearchIE._real_initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE._real_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">_real_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span></div>

<div class="viewcode-block" id="YoutubeSearchIE._real_extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE._real_extract">[docs]</a>    <span class="k">def</span> <span class="nf">_real_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VALID_QUERY</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;ERROR: invalid search query &quot;</span><span class="si">{query}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">prefix</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_n_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_n_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_youtube_results</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;ERROR: invalid download number </span><span class="si">{n}</span><span class="s1"> &#39;</span>
                        <span class="n">f</span><span class="s1">&#39;for query &quot;</span><span class="si">{query}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">elif</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_youtube_results</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">to_stderr</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;WARNING: ytsearch returns max &#39;</span>
                        <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self._max_youtube_results:d}</span><span class="s1"> &#39;</span>
                        <span class="n">f</span><span class="s1">&#39;results (you requested </span><span class="si">{n:d}</span><span class="s1">)&#39;</span><span class="p">)</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_youtube_results</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_n_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># parsing prefix as integer fails</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_download_n_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span></div>

<div class="viewcode-block" id="YoutubeSearchIE._download_n_results"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubeSearchIE._download_n_results">[docs]</a>    <span class="k">def</span> <span class="nf">_download_n_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Downloads a specified number of results for a query&#39;&#39;&#39;</span>

        <span class="n">video_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">already_seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">pagenum</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_download_page</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">pagenum</span><span class="p">)</span>
            <span class="n">result_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TEMPLATE_URL</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">pagenum</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">result_url</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_headers</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;ERROR: unable to download webpage: {str(err)}&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Extract video identifiers</span>
            <span class="k">for</span> <span class="n">mobj</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VIDEO_INDICATOR</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
                <span class="n">video_id</span> <span class="o">=</span> \
                    <span class="n">page</span><span class="p">[</span><span class="n">mobj</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span><span class="n">mobj</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">already_seen</span><span class="p">:</span>
                    <span class="n">video_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
                    <span class="n">already_seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video_ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                        <span class="c1"># Specified n videos reached</span>
                        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">video_ids</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                                <span class="n">f</span><span class="s1">&#39;https://www.youtube.com/watch?v=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MORE_PAGES_INDICATOR</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">video_ids</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;https://www.youtube.com/watch?v=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">pagenum</span> <span class="o">=</span> <span class="n">pagenum</span> <span class="o">+</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="YoutubePlaylistIE"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubePlaylistIE">[docs]</a><span class="k">class</span> <span class="nc">YoutubePlaylistIE</span><span class="p">(</span><span class="n">InfoExtractor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Information Extractor for YouTube playlists.&#39;&#39;&#39;</span>

    <span class="n">_VALID_URL</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:https://)?(?:\w+\.)?youtube.com/&#39;</span> \
                 <span class="sa">r</span><span class="s1">&#39;(?:view_play_list|my_playlists)\?.*?p=([^&amp;]+).*&#39;</span>
    <span class="n">_TEMPLATE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://www.youtube.com/view_play_list?&#39;</span> \
                    <span class="s1">&#39;p=</span><span class="si">%s</span><span class="s1">&amp;page=</span><span class="si">%s</span><span class="s1">&amp;gl=US&amp;hl=en&#39;</span>
    <span class="n">_VIDEO_INDICATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/watch\?v=(.+?)&amp;&#39;</span>
    <span class="n">_MORE_PAGES_INDICATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/view_play_list?p=</span><span class="si">%s</span><span class="s1">&amp;page=</span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">_youtube_ie</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">youtube_ie</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">InfoExtractor</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span> <span class="o">=</span> <span class="n">youtube_ie</span>

<div class="viewcode-block" id="YoutubePlaylistIE.suitable"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubePlaylistIE.suitable">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">suitable</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">YoutubePlaylistIE</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="YoutubePlaylistIE.report_download_page"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubePlaylistIE.report_download_page">[docs]</a>    <span class="k">def</span> <span class="nf">report_download_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playlist_id</span><span class="p">,</span> <span class="n">pagenum</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report attempt to download playlist page with given number.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stdout</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;[youtube] PL </span><span class="si">{playlist_id}</span><span class="s1">: Downloading page #</span><span class="si">{pagenum}</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="YoutubePlaylistIE._real_initialize"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubePlaylistIE._real_initialize">[docs]</a>    <span class="k">def</span> <span class="nf">_real_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span></div>

<div class="viewcode-block" id="YoutubePlaylistIE._real_extract"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.YoutubePlaylistIE._real_extract">[docs]</a>    <span class="k">def</span> <span class="nf">_real_extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="c1"># Extract playlist id</span>
        <span class="n">mobj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VALID_URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;ERROR: invalid url: </span><span class="si">{url}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Download playlist pages</span>
        <span class="n">playlist_id</span> <span class="o">=</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">video_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pagenum</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_download_page</span><span class="p">(</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">pagenum</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_TEMPLATE_URL</span> <span class="o">%</span> <span class="p">(</span><span class="n">playlist_id</span><span class="p">,</span> <span class="n">pagenum</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="n">std_headers</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">HTTPException</span><span class="p">,</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">trouble</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;ERROR: unable to download webpage: {str(err)}&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Extract video identifiers</span>
            <span class="n">ids_in_page</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">mobj</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_VIDEO_INDICATOR</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ids_in_page</span><span class="p">:</span>
                    <span class="n">ids_in_page</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">video_ids</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ids_in_page</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_MORE_PAGES_INDICATOR</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">playlist_id</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pagenum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">page</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">pagenum</span> <span class="o">=</span> <span class="n">pagenum</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">video_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_youtube_ie</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;https://www.youtube.com/watch?v=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="PostProcessor"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessor">[docs]</a><span class="k">class</span> <span class="nc">PostProcessor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Post Processor class.</span>

<span class="sd">    PostProcessor objects can be added to downloaders with their</span>
<span class="sd">    add_post_processor() method. When the downloader has finished a</span>
<span class="sd">    successful download, it will take its internal chain of PostProcessors</span>
<span class="sd">    and start calling the run() method on each one of them, first with</span>
<span class="sd">    an initial argument and then with the returned value of the previous</span>
<span class="sd">    PostProcessor.</span>

<span class="sd">    The chain will be stopped if one of them ever returns None or the end</span>
<span class="sd">    of the chain is reached.</span>

<span class="sd">    PostProcessor objects follow a &quot;mutual registration&quot; process similar</span>
<span class="sd">    to InfoExtractor objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">_downloader</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="o">=</span> <span class="n">downloader</span>

<div class="viewcode-block" id="PostProcessor.to_stdout"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessor.to_stdout">[docs]</a>    <span class="k">def</span> <span class="nf">to_stdout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stdout if downloader is not in quiet mode.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;quiet&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostProcessor.to_stderr"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessor.to_stderr">[docs]</a>    <span class="k">def</span> <span class="nf">to_stderr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print message to stderr.&#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span></div>

<div class="viewcode-block" id="PostProcessor.set_downloader"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessor.set_downloader">[docs]</a>    <span class="k">def</span> <span class="nf">set_downloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downloader</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the downloader for this PP.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_downloader</span> <span class="o">=</span> <span class="n">downloader</span></div>

<div class="viewcode-block" id="PostProcessor.run"><a class="viewcode-back" href="../../../../source/extern/youtubedl/youtubedl.html#coherence.extern.youtubedl.youtubedl.PostProcessor.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">information</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Run the PostProcessor.</span>

<span class="sd">        The &quot;information&quot; argument is a dictionary like the ones</span>
<span class="sd">        composed by InfoExtractors. The only difference is that this</span>
<span class="sd">        one has an extra field called &quot;filepath&quot; that points to the</span>
<span class="sd">        downloaded file.</span>

<span class="sd">        When this method returns None, the postprocessing chain is</span>
<span class="sd">        stopped. However, this method may return an information</span>
<span class="sd">        dictionary that will be passed to the next postprocessing</span>
<span class="sd">        object in the chain. It can be the one it received after</span>
<span class="sd">        changing some fields.</span>

<span class="sd">        In addition, this method may raise a PostProcessingError</span>
<span class="sd">        exception that will be taken into account by the downloader</span>
<span class="sd">        it was called from.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">information</span>  <span class="c1"># by default, do nothing</span></div></div>


<span class="c1"># MAIN PROGRAM</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Modules needed only when running the main program</span>
        <span class="kn">import</span> <span class="nn">getpass</span>
        <span class="kn">import</span> <span class="nn">optparse</span>

        <span class="c1"># General configuration</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">install_opener</span><span class="p">(</span>
            <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">()))</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">install_opener</span><span class="p">(</span>
            <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">()))</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">setdefaulttimeout</span><span class="p">(</span>
            <span class="mi">300</span><span class="p">)</span>  <span class="c1"># 5 minutes should be enough (famous last words)</span>

        <span class="c1"># Parse command line</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span>
            <span class="n">usage</span><span class="o">=</span><span class="s1">&#39;Usage: %prog [options] url...&#39;</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="s1">&#39;2009.09.13&#39;</span><span class="p">,</span>
            <span class="n">conflict_handler</span><span class="o">=</span><span class="s1">&#39;resolve&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print this help text and exit&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="s1">&#39;--version&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;print program version and exit&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--ignore-errors&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;ignoreerrors&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;continue on download errors&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--rate-limit&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;ratelimit&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;download rate limit (e.g. 50k or 44.6m)&#39;</span><span class="p">)</span>

        <span class="n">authentication</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s1">&#39;Authentication Options&#39;</span><span class="p">)</span>
        <span class="n">authentication</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--username&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;UN&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account username&#39;</span><span class="p">)</span>
        <span class="n">authentication</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--password&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;PW&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;account password&#39;</span><span class="p">)</span>
        <span class="n">authentication</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--netrc&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;usenetrc&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;use .netrc authentication data&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">authentication</span><span class="p">)</span>

        <span class="n">video_format</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s1">&#39;Video Format Options&#39;</span><span class="p">)</span>
        <span class="n">video_format</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--format&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FMT&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;video format code&#39;</span><span class="p">)</span>
        <span class="n">video_format</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--best-quality&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;download the best quality video possible&#39;</span><span class="p">,</span>
            <span class="n">const</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">video_format</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--mobile-version&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;alias for -f 17&#39;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s1">&#39;17&#39;</span><span class="p">)</span>
        <span class="n">video_format</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--high-def&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;format&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;alias for -f 22&#39;</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="s1">&#39;22&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">video_format</span><span class="p">)</span>

        <span class="n">verbosity</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span>
            <span class="n">parser</span><span class="p">,</span> <span class="s1">&#39;Verbosity / Simulation Options&#39;</span><span class="p">)</span>
        <span class="n">verbosity</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-q&#39;</span><span class="p">,</span> <span class="s1">&#39;--quiet&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;quiet&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;activates quiet mode&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">verbosity</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="s1">&#39;--simulate&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;simulate&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;do not download video&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">verbosity</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--get-url&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;geturl&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;simulate, quiet but print URL&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">verbosity</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;--get-title&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;gettitle&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;simulate, quiet but print title&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="n">filesystem</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionGroup</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s1">&#39;Filesystem Options&#39;</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--title&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;usetitle&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;use title in file name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="s1">&#39;--literal&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;useliteral&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;use literal title in file name&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;outtmpl&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;TPL&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output filename template&#39;</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--batch-file&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;batchfile&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;file containing URLs to download&#39;</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--no-overwrites&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;nooverwrites&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;do not overwrite files&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--continue&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;continue_dl&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s1">&#39;resume partially downloaded files&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option_group</span><span class="p">(</span><span class="n">filesystem</span><span class="p">)</span>

        <span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

        <span class="c1"># Batch file verification</span>
        <span class="n">batchurls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">batchfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">batchurls</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">batchfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="n">batchurls</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">batchurls</span><span class="p">]</span>
                <span class="n">batchurls</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">batchurls</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;ERROR: batch file could not be read&#39;</span><span class="p">)</span>
        <span class="n">all_urls</span> <span class="o">=</span> <span class="n">batchurls</span> <span class="o">+</span> <span class="n">args</span>

        <span class="c1"># Conflicting, missing and erroneous options</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_urls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;you must provide at least one URL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">usenetrc</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;using .netrc conflicts with giving username/password&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;account username missing&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">outtmpl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">useliteral</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">usetitle</span><span class="p">):</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;using output template conflicts &#39;</span>
                <span class="s1">&#39;with using title or literal title&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">usetitle</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">useliteral</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;using title conflicts with using literal title&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span>
                <span class="s1">&#39;Type account password and press return:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">ratelimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">numeric_limit</span> <span class="o">=</span> <span class="n">FileDownloader</span><span class="o">.</span><span class="n">parse_bytes</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ratelimit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numeric_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;invalid rate limit specified&#39;</span><span class="p">)</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">ratelimit</span> <span class="o">=</span> <span class="n">numeric_limit</span>

        <span class="c1"># Information extractors</span>
        <span class="n">youtube_ie</span> <span class="o">=</span> <span class="n">YoutubeIE</span><span class="p">()</span>
        <span class="n">metacafe_ie</span> <span class="o">=</span> <span class="n">MetacafeIE</span><span class="p">(</span><span class="n">youtube_ie</span><span class="p">)</span>
        <span class="n">youtube_pl_ie</span> <span class="o">=</span> <span class="n">YoutubePlaylistIE</span><span class="p">(</span><span class="n">youtube_ie</span><span class="p">)</span>
        <span class="n">youtube_search_ie</span> <span class="o">=</span> <span class="n">YoutubeSearchIE</span><span class="p">(</span><span class="n">youtube_ie</span><span class="p">)</span>

        <span class="c1"># File downloader</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">FileDownloader</span><span class="p">({</span>
            <span class="s1">&#39;usenetrc&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">usenetrc</span><span class="p">,</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
            <span class="s1">&#39;quiet&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">quiet</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">geturl</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">gettitle</span><span class="p">),</span>
            <span class="s1">&#39;forceurl&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">geturl</span><span class="p">,</span>
            <span class="s1">&#39;forcetitle&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">gettitle</span><span class="p">,</span>
            <span class="s1">&#39;simulate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">simulate</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">geturl</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">gettitle</span><span class="p">),</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
            <span class="s1">&#39;outtmpl&#39;</span><span class="p">:</span>
                <span class="p">((</span><span class="n">opts</span><span class="o">.</span><span class="n">outtmpl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">outtmpl</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
                    <span class="n">preferredencoding</span><span class="p">()))</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">usetitle</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="si">%(stitle)s</span><span class="s1">-</span><span class="si">%(id)s</span><span class="s1">.</span><span class="si">%(ext)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">useliteral</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="si">%(title)s</span><span class="s1">-</span><span class="si">%(id)s</span><span class="s1">.</span><span class="si">%(ext)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="s1">&#39;</span><span class="si">%(id)s</span><span class="s1">.</span><span class="si">%(ext)s</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="s1">&#39;ignoreerrors&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">ignoreerrors</span><span class="p">,</span>
            <span class="s1">&#39;ratelimit&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">ratelimit</span><span class="p">,</span>
            <span class="s1">&#39;nooverwrites&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">nooverwrites</span><span class="p">,</span>
            <span class="s1">&#39;continuedl&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">continue_dl</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">add_info_extractor</span><span class="p">(</span><span class="n">youtube_search_ie</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">add_info_extractor</span><span class="p">(</span><span class="n">youtube_pl_ie</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">add_info_extractor</span><span class="p">(</span><span class="n">metacafe_ie</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">add_info_extractor</span><span class="p">(</span><span class="n">youtube_ie</span><span class="p">)</span>
        <span class="n">retcode</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">all_urls</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">retcode</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">DownloadError</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SameFileError</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;ERROR: fixed output name but more than one file to download&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: Interrupted by user&#39;</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Pol Canelles

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>